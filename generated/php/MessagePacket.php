<?php
// Auto-generated by CrossPacket - do not modify manually

declare(strict_types=1);

namespace App\DataPackets;

use DateTimeImmutable;
use DateTimeInterface;
use JsonSerializable;

/**
 * A chat message packet for real-time communication
 */
class MessagePacket implements JsonSerializable
{
    public const TYPE = '/chat/MessagePacket';

    /** @var ?string Unique identifier of the sender */
    private ?string $sender_id = null;
    /** @var ?string Message content */
    private ?string $content = null;
    /** @var ?DateTimeImmutable When the message was sent */
    private ?DateTimeImmutable $timestamp = null;

    public function __construct(
        ?string $sender_id = null,
        ?string $content = null,
        ?DateTimeImmutable $timestamp = null
    )
    {
        $this->sender_id = $sender_id;
        $this->content = $content;
        $this->timestamp = $timestamp;
    }

    public function getSenderId(): ?string
    {
        return $this->sender_id;
    }

    public function setSenderId(string $sender_id): self
    {
        $this->sender_id = $sender_id;
        return $this;
    }

    public function getContent(): ?string
    {
        return $this->content;
    }

    public function setContent(string $content): self
    {
        $this->content = $content;
        return $this;
    }

    public function getTimestamp(): ?DateTimeImmutable
    {
        return $this->timestamp;
    }

    public function setTimestamp(DateTimeImmutable $timestamp): self
    {
        $this->timestamp = $timestamp;
        return $this;
    }

    public function jsonSerialize(): array
    {
        return [
            'packetType' => self::TYPE,
            'sender_id' => $this->sender_id,
            'content' => $this->content,
            'timestamp' => $this->timestamp?->format(\DateTimeInterface::ATOM),
        ];
    }

    public function toJson(): string
    {
        return json_encode($this->jsonSerialize(), JSON_THROW_ON_ERROR);
    }

    public static function fromJson(string $json): self
    {
        $data = json_decode($json, true, 512, JSON_THROW_ON_ERROR);
        $instance = new self();
        if (isset($data['sender_id'])) {
            $instance->setSenderId($data['sender_id']);
        }
        if (isset($data['content'])) {
            $instance->setContent($data['content']);
        }
        if (isset($data['timestamp'])) {
            $instance->setTimestamp(new \DateTimeImmutable($data['timestamp']));
        }
        return $instance;
    }

    public function toMsgPack(): string
    {
        return msgpack_pack($this->jsonSerialize());
    }

    public static function fromMsgPack(string $data): self
    {
        $arr = msgpack_unpack($data);
        $instance = new self();
        if (isset($arr['sender_id'])) {
            $instance->setSenderId($arr['sender_id']);
        }
        if (isset($arr['content'])) {
            $instance->setContent($arr['content']);
        }
        if (isset($arr['timestamp'])) {
            $instance->setTimestamp(new \DateTimeImmutable($arr['timestamp']));
        }
        return $instance;
    }
}