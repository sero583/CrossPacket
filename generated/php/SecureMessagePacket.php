<?php
// Auto-generated by CrossPacket - do not modify manually

declare(strict_types=1);

namespace App\DataPackets;

use DateTimeImmutable;
use DateTimeInterface;
use JsonSerializable;

/**
 * Security-hardened message packet with strict validation
 */
class SecureMessagePacket implements JsonSerializable
{
    public const TYPE = '/example/SecureMessagePacket';

    /** @var ?string UUID message identifier */
    private ?string $message_id = null;
    /** @var ?int Sender user ID */
    private ?int $sender_id = null;
    /** @var ?int Recipient user ID */
    private ?int $recipient_id = null;
    /** @var ?string Message subject (max 200 chars) */
    private ?string $subject = null;
    /** @var ?string Message body (max 10000 chars) */
    private ?string $body = null;
    /** @var ?array Attachment metadata (max 5 files) */
    private ?array $attachments = null;
    /** @var ?string Encrypted message content (max 10MB) */
    private ?string $encrypted_payload = null;
    /** @var ?int Message priority (1-5) */
    private ?int $priority = null;
    /** @var ?bool Read status flag */
    private ?bool $is_read = null;
    /** @var ?DateTimeImmutable Send timestamp */
    private ?DateTimeImmutable $sent_at = null;

    public function __construct(
        ?string $message_id = null,
        ?int $sender_id = null,
        ?int $recipient_id = null,
        ?string $subject = null,
        ?string $body = null,
        ?array $attachments = null,
        ?string $encrypted_payload = null,
        ?int $priority = null,
        ?bool $is_read = null,
        ?DateTimeImmutable $sent_at = null
    )
    {
        $this->message_id = $message_id;
        $this->sender_id = $sender_id;
        $this->recipient_id = $recipient_id;
        $this->subject = $subject;
        $this->body = $body;
        $this->attachments = $attachments;
        $this->encrypted_payload = $encrypted_payload;
        $this->priority = $priority;
        $this->is_read = $is_read;
        $this->sent_at = $sent_at;
    }

    public function getMessageId(): ?string
    {
        return $this->message_id;
    }

    public function setMessageId(string $message_id): self
    {
        $this->message_id = $message_id;
        return $this;
    }

    public function getSenderId(): ?int
    {
        return $this->sender_id;
    }

    public function setSenderId(int $sender_id): self
    {
        $this->sender_id = $sender_id;
        return $this;
    }

    public function getRecipientId(): ?int
    {
        return $this->recipient_id;
    }

    public function setRecipientId(int $recipient_id): self
    {
        $this->recipient_id = $recipient_id;
        return $this;
    }

    public function getSubject(): ?string
    {
        return $this->subject;
    }

    public function setSubject(string $subject): self
    {
        $this->subject = $subject;
        return $this;
    }

    public function getBody(): ?string
    {
        return $this->body;
    }

    public function setBody(string $body): self
    {
        $this->body = $body;
        return $this;
    }

    public function getAttachments(): ?array
    {
        return $this->attachments;
    }

    public function setAttachments(array $attachments): self
    {
        $this->attachments = $attachments;
        return $this;
    }

    public function getEncryptedPayload(): ?string
    {
        return $this->encrypted_payload;
    }

    public function setEncryptedPayload(?string $encrypted_payload): self
    {
        $this->encrypted_payload = $encrypted_payload;
        return $this;
    }

    public function getPriority(): ?int
    {
        return $this->priority;
    }

    public function setPriority(int $priority): self
    {
        $this->priority = $priority;
        return $this;
    }

    public function getIsRead(): ?bool
    {
        return $this->is_read;
    }

    public function setIsRead(bool $is_read): self
    {
        $this->is_read = $is_read;
        return $this;
    }

    public function getSentAt(): ?DateTimeImmutable
    {
        return $this->sent_at;
    }

    public function setSentAt(DateTimeImmutable $sent_at): self
    {
        $this->sent_at = $sent_at;
        return $this;
    }

    public function jsonSerialize(): array
    {
        return [
            'packetType' => self::TYPE,
            'message_id' => $this->message_id,
            'sender_id' => $this->sender_id,
            'recipient_id' => $this->recipient_id,
            'subject' => $this->subject,
            'body' => $this->body,
            'attachments' => $this->attachments,
            'encrypted_payload' => $this->encrypted_payload,
            'priority' => $this->priority,
            'is_read' => $this->is_read,
            'sent_at' => $this->sent_at?->format(\DateTimeInterface::ATOM),
        ];
    }

    public function toJson(): string
    {
        return json_encode($this->jsonSerialize(), JSON_THROW_ON_ERROR);
    }

    public static function fromJson(string $json): self
    {
        $data = json_decode($json, true, 512, JSON_THROW_ON_ERROR);
        $instance = new self();
        if (isset($data['message_id'])) {
            $instance->setMessageId($data['message_id']);
        }
        if (isset($data['sender_id'])) {
            $instance->setSenderId($data['sender_id']);
        }
        if (isset($data['recipient_id'])) {
            $instance->setRecipientId($data['recipient_id']);
        }
        if (isset($data['subject'])) {
            $instance->setSubject($data['subject']);
        }
        if (isset($data['body'])) {
            $instance->setBody($data['body']);
        }
        if (isset($data['attachments'])) {
            $instance->setAttachments($data['attachments']);
        }
        if (isset($data['encrypted_payload'])) {
            $instance->setEncryptedPayload($data['encrypted_payload']);
        }
        if (isset($data['priority'])) {
            $instance->setPriority($data['priority']);
        }
        if (isset($data['is_read'])) {
            $instance->setIsRead($data['is_read']);
        }
        if (isset($data['sent_at'])) {
            $instance->setSentAt(new \DateTimeImmutable($data['sent_at']));
        }
        return $instance;
    }

    public function toMsgPack(): string
    {
        return msgpack_pack($this->jsonSerialize());
    }

    public static function fromMsgPack(string $data): self
    {
        $arr = msgpack_unpack($data);
        $instance = new self();
        if (isset($arr['message_id'])) {
            $instance->setMessageId($arr['message_id']);
        }
        if (isset($arr['sender_id'])) {
            $instance->setSenderId($arr['sender_id']);
        }
        if (isset($arr['recipient_id'])) {
            $instance->setRecipientId($arr['recipient_id']);
        }
        if (isset($arr['subject'])) {
            $instance->setSubject($arr['subject']);
        }
        if (isset($arr['body'])) {
            $instance->setBody($arr['body']);
        }
        if (isset($arr['attachments'])) {
            $instance->setAttachments($arr['attachments']);
        }
        if (isset($arr['encrypted_payload'])) {
            $instance->setEncryptedPayload($arr['encrypted_payload']);
        }
        if (isset($arr['priority'])) {
            $instance->setPriority($arr['priority']);
        }
        if (isset($arr['is_read'])) {
            $instance->setIsRead($arr['is_read']);
        }
        if (isset($arr['sent_at'])) {
            $instance->setSentAt(new \DateTimeImmutable($arr['sent_at']));
        }
        return $instance;
    }
}