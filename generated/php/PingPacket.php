<?php
// Auto-generated by CrossPacket - do not modify manually

declare(strict_types=1);

namespace App\DataPackets;

use DateTimeImmutable;
use DateTimeInterface;
use JsonSerializable;

/**
 * Simple ping packet for connection testing
 */
class PingPacket implements JsonSerializable
{
    public const TYPE = '/example/PingPacket';

    /** @var ?DateTimeImmutable When the ping was sent */
    private ?DateTimeImmutable $timestamp = null;
    /** @var ?string Optional ping message */
    private ?string $message = null;

    public function __construct(
        ?DateTimeImmutable $timestamp = null,
        ?string $message = null
    )
    {
        $this->timestamp = $timestamp;
        $this->message = $message;
    }

    public function getTimestamp(): ?DateTimeImmutable
    {
        return $this->timestamp;
    }

    public function setTimestamp(DateTimeImmutable $timestamp): self
    {
        $this->timestamp = $timestamp;
        return $this;
    }

    public function getMessage(): ?string
    {
        return $this->message;
    }

    public function setMessage(string $message): self
    {
        $this->message = $message;
        return $this;
    }

    public function jsonSerialize(): array
    {
        return [
            'packetType' => self::TYPE,
            'timestamp' => $this->timestamp?->format(\DateTimeInterface::ATOM),
            'message' => $this->message,
        ];
    }

    public function toJson(): string
    {
        return json_encode($this->jsonSerialize(), JSON_THROW_ON_ERROR);
    }

    public static function fromJson(string $json): self
    {
        $data = json_decode($json, true, 512, JSON_THROW_ON_ERROR);
        $instance = new self();
        if (isset($data['timestamp'])) {
            $instance->setTimestamp(new \DateTimeImmutable($data['timestamp']));
        }
        if (isset($data['message'])) {
            $instance->setMessage($data['message']);
        }
        return $instance;
    }

    public function toMsgPack(): string
    {
        return msgpack_pack($this->jsonSerialize());
    }

    public static function fromMsgPack(string $data): self
    {
        $arr = msgpack_unpack($data);
        $instance = new self();
        if (isset($arr['timestamp'])) {
            $instance->setTimestamp(new \DateTimeImmutable($arr['timestamp']));
        }
        if (isset($arr['message'])) {
            $instance->setMessage($arr['message']);
        }
        return $instance;
    }
}