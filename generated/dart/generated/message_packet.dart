// This file is auto-generated. Do not modify manually.
// Generated by CrossPacket
import 'dart:convert';
import 'dart:typed_data';
import 'package:msgpack_dart/msgpack_dart.dart' as msgpack;
import '../data_packet.dart';

/// Formats a DateTime with timezone offset (ISO 8601).
String _formatDateTimeWithTimezone(DateTime dt) {
  final offset = dt.timeZoneOffset;
  final offsetSign = offset.isNegative ? '-' : '+';
  final offsetHours = offset.abs().inHours.toString().padLeft(2, '0');
  final offsetMinutes = (offset.abs().inMinutes % 60).toString().padLeft(2, '0');
  final year = dt.year.toString().padLeft(4, '0');
  final month = dt.month.toString().padLeft(2, '0');
  final day = dt.day.toString().padLeft(2, '0');
  final hour = dt.hour.toString().padLeft(2, '0');
  final minute = dt.minute.toString().padLeft(2, '0');
  final second = dt.second.toString().padLeft(2, '0');
  final millisecond = dt.millisecond.toString().padLeft(3, '0');
  return '$year-$month-${day}T$hour:$minute:$second.$millisecond$offsetSign$offsetHours:$offsetMinutes';
}

/// A chat message packet for real-time communication
class MessagePacket extends DataPacket {
  /// Unique identifier of the sender
  String? sender_id;
  /// Message content
  String? content;
  /// When the message was sent
  DateTime? timestamp;

  /// Creates an empty [MessagePacket]. Use setters to populate fields.
  MessagePacket();

  /// Creates a [MessagePacket] with all fields.
  MessagePacket.create({
    this.sender_id,
    this.content,
    this.timestamp,
  });

  @override
  String get type => '/chat/MessagePacket';

  @override
  Map<String, dynamic> serialize() => {
    'packetType': type,
    'sender_id': sender_id,
    'content': content,
    'timestamp': timestamp != null ? _formatDateTimeWithTimezone(timestamp!) : null,
  };

  /// Creates a [MessagePacket] from a JSON map (internal helper).
  static MessagePacket _fromMap(Map<String, dynamic> json) =>
    MessagePacket.create(
      sender_id: json['sender_id'],
      content: json['content'],
      timestamp: json['timestamp'] != null ? DateTime.parse(json['timestamp']) : null,
    );

  /// Serializes this packet to a JSON string.
  String toJson() => jsonEncode(serialize());

  /// Creates a [MessagePacket] from a JSON string.
  static MessagePacket fromJson(String jsonString) {
    return _fromMap(jsonDecode(jsonString) as Map<String, dynamic>);
  }

  /// Serializes this packet to MessagePack binary format.
  Uint8List toMsgPack() => msgpack.serialize(serialize());

  /// Creates a [MessagePacket] from MessagePack binary data.
  static MessagePacket fromMsgPack(Uint8List bytes) {
    final data = msgpack.deserialize(bytes);
    return _fromMap(Map<String, dynamic>.from(data as Map));
  }
}