// This file is auto-generated. Do not modify manually.
// Generated by CrossPacket
import 'dart:convert';
import 'dart:typed_data';
import 'package:msgpack_dart/msgpack_dart.dart' as msgpack;
import '../data_packet.dart';

/// Safely converts nested msgpack maps to Map<String, dynamic>.
Map<String, dynamic> _deepConvertMap(dynamic value) {
  if (value == null) return {};
  if (value is! Map) return {};
  return _safeMapConvert(value);
}

/// Recursively converts List elements.
List<dynamic> _safeListConvert(List<dynamic> list) {
  return list.map((item) {
    if (item is Map) return _safeMapConvert(item);
    if (item is List) return _safeListConvert(item);
    return item;
  }).toList();
}

/// Recursively converts Map<dynamic, dynamic> to Map<String, dynamic>.
Map<String, dynamic> _safeMapConvert(Map<dynamic, dynamic> map) {
  return map.map((key, value) {
    final stringKey = key?.toString() ?? '';
    dynamic convertedValue;
    if (value is Map) {
      convertedValue = _safeMapConvert(value);
    } else if (value is List) {
      convertedValue = _safeListConvert(value);
    } else {
      convertedValue = value;
    }
    return MapEntry(stringKey, convertedValue);
  });
}

/// Chunked data packet for progressive loading of large datasets
class DataChunkPacket extends DataPacket {
  /// Current chunk index (0-based)
  int? chunk_index;
  /// Total number of chunks
  int? total_chunks;
  /// Chunk data - native msgpack map
  Map<dynamic, dynamic>? data;
  /// Checksum for data integrity verification
  String? checksum;

  /// Creates an empty [DataChunkPacket]. Use setters to populate fields.
  DataChunkPacket();

  /// Creates a [DataChunkPacket] with all fields.
  DataChunkPacket.create({
    this.chunk_index,
    this.total_chunks,
    this.data,
    this.checksum,
  });

  @override
  String get type => '/example/DataChunkPacket';

  @override
  Map<String, dynamic> serialize() => {
    'packetType': type,
    'chunk_index': chunk_index,
    'total_chunks': total_chunks,
    'data': data,
    'checksum': checksum,
  };

  /// Creates a [DataChunkPacket] from a JSON map (internal helper).
  static DataChunkPacket _fromMap(Map<String, dynamic> json) =>
    DataChunkPacket.create(
      chunk_index: json['chunk_index'],
      total_chunks: json['total_chunks'],
      data: json['data'] != null ? _deepConvertMap(json['data']) : null,
      checksum: json['checksum'],
    );

  /// Serializes this packet to a JSON string.
  String toJson() => jsonEncode(serialize());

  /// Creates a [DataChunkPacket] from a JSON string.
  static DataChunkPacket fromJson(String jsonString) {
    return _fromMap(jsonDecode(jsonString) as Map<String, dynamic>);
  }

  /// Serializes this packet to MessagePack binary format.
  Uint8List toMsgPack() => msgpack.serialize(serialize());

  /// Creates a [DataChunkPacket] from MessagePack binary data.
  static DataChunkPacket fromMsgPack(Uint8List bytes) {
    final data = msgpack.deserialize(bytes);
    return _fromMap(Map<String, dynamic>.from(data as Map));
  }
}