// This file is auto-generated. Do not modify manually.
// Generated by CrossPacket
import 'dart:convert';
import 'dart:typed_data';
import 'package:msgpack_dart/msgpack_dart.dart' as msgpack;
import '../data_packet.dart';

/// Formats a DateTime with timezone offset (ISO 8601).
String _formatDateTimeWithTimezone(DateTime dt) {
  final offset = dt.timeZoneOffset;
  final offsetSign = offset.isNegative ? '-' : '+';
  final offsetHours = offset.abs().inHours.toString().padLeft(2, '0');
  final offsetMinutes = (offset.abs().inMinutes % 60).toString().padLeft(2, '0');
  final year = dt.year.toString().padLeft(4, '0');
  final month = dt.month.toString().padLeft(2, '0');
  final day = dt.day.toString().padLeft(2, '0');
  final hour = dt.hour.toString().padLeft(2, '0');
  final minute = dt.minute.toString().padLeft(2, '0');
  final second = dt.second.toString().padLeft(2, '0');
  final millisecond = dt.millisecond.toString().padLeft(3, '0');
  return '$year-$month-${day}T$hour:$minute:$second.$millisecond$offsetSign$offsetHours:$offsetMinutes';
}

/// Simple ping packet for connection testing
class PingPacket extends DataPacket {
  /// When the ping was sent
  DateTime? timestamp;
  /// Optional ping message
  String? message;

  /// Creates an empty [PingPacket]. Use setters to populate fields.
  PingPacket();

  /// Creates a [PingPacket] with all fields.
  PingPacket.create({
    this.timestamp,
    this.message,
  });

  @override
  String get type => '/example/PingPacket';

  @override
  Map<String, dynamic> serialize() => {
    'packetType': type,
    'timestamp': timestamp != null ? _formatDateTimeWithTimezone(timestamp!) : null,
    'message': message,
  };

  /// Creates a [PingPacket] from a JSON map (internal helper).
  static PingPacket _fromMap(Map<String, dynamic> json) =>
    PingPacket.create(
      timestamp: json['timestamp'] != null ? DateTime.parse(json['timestamp']) : null,
      message: json['message'],
    );

  /// Serializes this packet to a JSON string.
  String toJson() => jsonEncode(serialize());

  /// Creates a [PingPacket] from a JSON string.
  static PingPacket fromJson(String jsonString) {
    return _fromMap(jsonDecode(jsonString) as Map<String, dynamic>);
  }

  /// Serializes this packet to MessagePack binary format.
  Uint8List toMsgPack() => msgpack.serialize(serialize());

  /// Creates a [PingPacket] from MessagePack binary data.
  static PingPacket fromMsgPack(Uint8List bytes) {
    final data = msgpack.deserialize(bytes);
    return _fromMap(Map<String, dynamic>.from(data as Map));
  }
}