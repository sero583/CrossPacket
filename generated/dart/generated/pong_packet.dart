// This file is auto-generated. Do not modify manually.
// Generated by CrossPacket
import 'dart:convert';
import 'dart:typed_data';
import 'package:msgpack_dart/msgpack_dart.dart' as msgpack;
import '../data_packet.dart';

/// Formats a DateTime with timezone offset (ISO 8601).
String _formatDateTimeWithTimezone(DateTime dt) {
  final offset = dt.timeZoneOffset;
  final offsetSign = offset.isNegative ? '-' : '+';
  final offsetHours = offset.abs().inHours.toString().padLeft(2, '0');
  final offsetMinutes = (offset.abs().inMinutes % 60).toString().padLeft(2, '0');
  final year = dt.year.toString().padLeft(4, '0');
  final month = dt.month.toString().padLeft(2, '0');
  final day = dt.day.toString().padLeft(2, '0');
  final hour = dt.hour.toString().padLeft(2, '0');
  final minute = dt.minute.toString().padLeft(2, '0');
  final second = dt.second.toString().padLeft(2, '0');
  final millisecond = dt.millisecond.toString().padLeft(3, '0');
  return '$year-$month-${day}T$hour:$minute:$second.$millisecond$offsetSign$offsetHours:$offsetMinutes';
}

/// Response to a ping packet
class PongPacket extends DataPacket {
  /// Timestamp from the original ping
  DateTime? original_timestamp;
  /// When the pong was sent
  DateTime? response_timestamp;
  /// Calculated latency in milliseconds
  int? latency_ms;

  /// Creates an empty [PongPacket]. Use setters to populate fields.
  PongPacket();

  /// Creates a [PongPacket] with all fields.
  PongPacket.create({
    this.original_timestamp,
    this.response_timestamp,
    this.latency_ms,
  });

  @override
  String get type => '/example/PongPacket';

  @override
  Map<String, dynamic> serialize() => {
    'packetType': type,
    'original_timestamp': original_timestamp != null ? _formatDateTimeWithTimezone(original_timestamp!) : null,
    'response_timestamp': response_timestamp != null ? _formatDateTimeWithTimezone(response_timestamp!) : null,
    'latency_ms': latency_ms,
  };

  /// Creates a [PongPacket] from a JSON map (internal helper).
  static PongPacket _fromMap(Map<String, dynamic> json) =>
    PongPacket.create(
      original_timestamp: json['original_timestamp'] != null ? DateTime.parse(json['original_timestamp']) : null,
      response_timestamp: json['response_timestamp'] != null ? DateTime.parse(json['response_timestamp']) : null,
      latency_ms: json['latency_ms'],
    );

  /// Serializes this packet to a JSON string.
  String toJson() => jsonEncode(serialize());

  /// Creates a [PongPacket] from a JSON string.
  static PongPacket fromJson(String jsonString) {
    return _fromMap(jsonDecode(jsonString) as Map<String, dynamic>);
  }

  /// Serializes this packet to MessagePack binary format.
  Uint8List toMsgPack() => msgpack.serialize(serialize());

  /// Creates a [PongPacket] from MessagePack binary data.
  static PongPacket fromMsgPack(Uint8List bytes) {
    final data = msgpack.deserialize(bytes);
    return _fromMap(Map<String, dynamic>.from(data as Map));
  }
}