// This file is auto-generated. Do not modify manually.
// Generated by CrossPacket
import 'dart:convert';
import 'dart:typed_data';
import 'package:msgpack_dart/msgpack_dart.dart' as msgpack;
import '../data_packet.dart';

/// Formats a DateTime with timezone offset (ISO 8601).
String _formatDateTimeWithTimezone(DateTime dt) {
  final offset = dt.timeZoneOffset;
  final offsetSign = offset.isNegative ? '-' : '+';
  final offsetHours = offset.abs().inHours.toString().padLeft(2, '0');
  final offsetMinutes = (offset.abs().inMinutes % 60).toString().padLeft(2, '0');
  final year = dt.year.toString().padLeft(4, '0');
  final month = dt.month.toString().padLeft(2, '0');
  final day = dt.day.toString().padLeft(2, '0');
  final hour = dt.hour.toString().padLeft(2, '0');
  final minute = dt.minute.toString().padLeft(2, '0');
  final second = dt.second.toString().padLeft(2, '0');
  final millisecond = dt.millisecond.toString().padLeft(3, '0');
  return '$year-$month-${day}T$hour:$minute:$second.$millisecond$offsetSign$offsetHours:$offsetMinutes';
}

/// Safely converts nested msgpack maps to Map<String, dynamic>.
Map<String, dynamic> _deepConvertMap(dynamic value) {
  if (value == null) return {};
  if (value is! Map) return {};
  return _safeMapConvert(value);
}

/// Recursively converts List elements.
List<dynamic> _safeListConvert(List<dynamic> list) {
  return list.map((item) {
    if (item is Map) return _safeMapConvert(item);
    if (item is List) return _safeListConvert(item);
    return item;
  }).toList();
}

/// Recursively converts Map<dynamic, dynamic> to Map<String, dynamic>.
Map<String, dynamic> _safeMapConvert(Map<dynamic, dynamic> map) {
  return map.map((key, value) {
    final stringKey = key?.toString() ?? '';
    dynamic convertedValue;
    if (value is Map) {
      convertedValue = _safeMapConvert(value);
    } else if (value is List) {
      convertedValue = _safeListConvert(value);
    } else {
      convertedValue = value;
    }
    return MapEntry(stringKey, convertedValue);
  });
}

/// Test packet containing ALL supported types for comprehensive testing
class ComprehensivePacket extends DataPacket {
  /// Integer field for testing int serialization
  int? int_field;
  /// Float field for testing float serialization
  double? float_field;
  /// Double precision field for testing
  double? double_field;
  /// String field for testing string serialization
  String? string_field;
  /// Boolean field for testing bool serialization
  bool? bool_field;
  /// DateTime field for testing datetime serialization
  DateTime? datetime_field;
  /// Time-only field for testing time serialization
  TimeOfDay? time_field;
  /// List field for testing list serialization
  List<dynamic>? list_field;
  /// Integer list field for testing typed list serialization
  List<int>? list_int_field;
  /// String list field for testing typed list serialization
  List<String>? list_string_field;
  /// Map field for testing map serialization
  Map<String, dynamic>? map_field;
  /// Embedded map field for testing embedded map serialization
  Map<dynamic, dynamic>? embedded_map_field;
  /// String-keyed dynamic map field
  Map<String, dynamic>? map_string_dynamic_field;
  /// Bytes field for testing binary serialization
  Uint8List? bytes_field;

  /// Creates an empty [ComprehensivePacket]. Use setters to populate fields.
  ComprehensivePacket();

  /// Creates a [ComprehensivePacket] with all fields.
  ComprehensivePacket.create({
    this.int_field,
    this.float_field,
    this.double_field,
    this.string_field,
    this.bool_field,
    this.datetime_field,
    this.time_field,
    this.list_field,
    this.list_int_field,
    this.list_string_field,
    this.map_field,
    this.embedded_map_field,
    this.map_string_dynamic_field,
    this.bytes_field,
  });

  @override
  String get type => '/test/ComprehensivePacket';

  @override
  Map<String, dynamic> serialize() => {
    'packetType': type,
    'int_field': int_field,
    'float_field': float_field,
    'double_field': double_field,
    'string_field': string_field,
    'bool_field': bool_field,
    'datetime_field': datetime_field != null ? _formatDateTimeWithTimezone(datetime_field!) : null,
    'time_field': time_field != null ? '${time_field!.hour.toString().padLeft(2, '0')}:${time_field!.minute.toString().padLeft(2, '0')}' : null,
    'list_field': list_field,
    'list_int_field': list_int_field,
    'list_string_field': list_string_field,
    'map_field': map_field,
    'embedded_map_field': embedded_map_field,
    'map_string_dynamic_field': map_string_dynamic_field,
    'bytes_field': bytes_field != null ? base64Encode(bytes_field!) : null,
  };

  /// Creates a [ComprehensivePacket] from a JSON map (internal helper).
  static ComprehensivePacket _fromMap(Map<String, dynamic> json) =>
    ComprehensivePacket.create(
      int_field: json['int_field'],
      float_field: (json['float_field'] as num?)?.toDouble(),
      double_field: (json['double_field'] as num?)?.toDouble(),
      string_field: json['string_field'],
      bool_field: json['bool_field'],
      datetime_field: json['datetime_field'] != null ? DateTime.parse(json['datetime_field']) : null,
      time_field: json['time_field'] != null ? TimeOfDay(hour: int.parse(json['time_field'].split(':')[0]), minute: int.parse(json['time_field'].split(':')[1])) : null,
      list_field: json['list_field'] as List<dynamic>?,
      list_int_field: (json['list_int_field'] as List<dynamic>?)?.map((e) => e as int).toList(),
      list_string_field: (json['list_string_field'] as List<dynamic>?)?.map((e) => e.toString()).toList(),
      map_field: json['map_field'] != null ? Map<String, dynamic>.from(json['map_field'] as Map) : null,
      embedded_map_field: json['embedded_map_field'] != null ? _deepConvertMap(json['embedded_map_field']) : null,
      map_string_dynamic_field: json['map_string_dynamic_field'] != null ? Map<String, dynamic>.from(json['map_string_dynamic_field'] as Map) : null,
      bytes_field: json['bytes_field'] != null ? base64Decode(json['bytes_field']) : null,
    );

  /// Serializes this packet to a JSON string.
  String toJson() => jsonEncode(serialize());

  /// Creates a [ComprehensivePacket] from a JSON string.
  static ComprehensivePacket fromJson(String jsonString) {
    return _fromMap(jsonDecode(jsonString) as Map<String, dynamic>);
  }

  /// Serializes this packet to MessagePack binary format.
  Uint8List toMsgPack() => msgpack.serialize(serialize());

  /// Creates a [ComprehensivePacket] from MessagePack binary data.
  static ComprehensivePacket fromMsgPack(Uint8List bytes) {
    final data = msgpack.deserialize(bytes);
    return _fromMap(Map<String, dynamic>.from(data as Map));
  }
}