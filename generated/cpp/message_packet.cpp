// Auto-generated by CrossPacket - do not modify manually
#include "message_packet.hpp"
#include <cstdlib>

namespace packets {

MessagePacket::MessagePacket(const std::string& sender_id, const std::string& content, const std::string& timestamp)
    : sender_id_(sender_id), content_(content), timestamp_(timestamp) {}

std::string MessagePacket::ToJson() const {
    yyjson_mut_doc* doc = yyjson_mut_doc_new(nullptr);
    yyjson_mut_val* root = yyjson_mut_obj(doc);
    yyjson_mut_doc_set_root(doc, root);

    yyjson_mut_obj_add_str(doc, root, "packetType", TYPE);
    yyjson_mut_obj_add_strcpy(doc, root, "sender_id", sender_id_.c_str());
    yyjson_mut_obj_add_strcpy(doc, root, "content", content_.c_str());
    yyjson_mut_obj_add_strcpy(doc, root, "timestamp", timestamp_.c_str());

    char* json = yyjson_mut_write(doc, 0, nullptr);
    std::string result(json);
    free(json);
    yyjson_mut_doc_free(doc);
    return result;
}

MessagePacket MessagePacket::FromJson(const std::string& json) {
    yyjson_doc* doc = yyjson_read(json.c_str(), json.size(), 0);
    if (!doc) {
        throw std::runtime_error("JSON parse error");
    }

    yyjson_val* root = yyjson_doc_get_root(doc);
    MessagePacket packet;

    yyjson_val* sender_id_val = yyjson_obj_get(root, "sender_id");
    if (sender_id_val && yyjson_is_str(sender_id_val)) {
        packet.sender_id_ = yyjson_get_str(sender_id_val);
    }
    yyjson_val* content_val = yyjson_obj_get(root, "content");
    if (content_val && yyjson_is_str(content_val)) {
        packet.content_ = yyjson_get_str(content_val);
    }
    yyjson_val* timestamp_val = yyjson_obj_get(root, "timestamp");
    if (timestamp_val && yyjson_is_str(timestamp_val)) {
        packet.timestamp_ = yyjson_get_str(timestamp_val);
    }

    yyjson_doc_free(doc);
    return packet;
}

std::vector<uint8_t> MessagePacket::ToMsgPack() const {
    msgpack::sbuffer buffer;
    msgpack::pack(buffer, *this);
    return std::vector<uint8_t>(buffer.data(), buffer.data() + buffer.size());
}

MessagePacket MessagePacket::FromMsgPack(const std::vector<uint8_t>& data) {
    msgpack::object_handle oh = msgpack::unpack(reinterpret_cast<const char*>(data.data()), data.size());
    return oh.get().as<MessagePacket>();
}

} // namespace packets